document.addEventListener("DOMContentLoaded",()=>{function e(){recognizer=speechCommands.create("BROWSER_FFT"),Promise.all([recognizer.ensureModelLoaded()]).then(function(){words=recognizer.wordLabels(),modelLoaded=!0,w.classList.add("hide"),v.classList.remove("hide")})}function s(){recognizer.listen(({scores:e})=>{switch(e=Array.from(e).map((e,s)=>({score:e,word:words[s]})),e.sort((e,s)=>s.score-e.score),e[0].word){case"up":a(1);break;case"right":a(2);break;case"down":a(3);break;case"left":a(4)}console.log(e[0].word)},{probabilityThreshold:.75})}function t(){for(let e=0;e<E.length;e++){const s=document.createElement("div");b.appendChild(s),T.push(s),0===E[e]?T[e].classList.add("pac-dot"):1===E[e]?T[e].classList.add("wall"):2===E[e]?T[e].classList.add("ghost-lair"):3===E[e]&&T[e].classList.add("power-pellet")}}function a(e){switch(p=e,p){case 1:h.innerHTML="UP";break;case 2:h.innerHTML="RIGHT";break;case 3:h.innerHTML="DOWN";break;case 4:h.innerHTML="LEFT"}}function n(e){switch(T[N].classList.remove("pac-man"),e.keyCode){case 37:a(4);break;case 38:a(1);break;case 39:a(2);break;case 40:a(3)}}function c(){T[N].classList.contains("pac-dot")&&(f++,m.innerHTML=f,T[N].classList.remove("pac-dot"))}function r(){T[N].classList.contains("power-pellet")&&(f+=10,ghosts.forEach(e=>e.isScared=!0),setTimeout(o,1e4),T[N].classList.remove("power-pellet"))}function o(){ghosts.forEach(e=>e.isScared=!1)}function i(e){const s=[-1,1,g,-g];let t=s[Math.floor(Math.random()*s.length)];e.timerId=setInterval(function(){T[e.currentIndex+t].classList.contains("ghost")||T[e.currentIndex+t].classList.contains("wall")?t=s[Math.floor(Math.random()*s.length)]:(T[e.currentIndex].classList.remove(e.className),T[e.currentIndex].classList.remove("ghost","scared-ghost"),e.currentIndex+=t,T[e.currentIndex].classList.add(e.className,"ghost")),e.isScared&&T[e.currentIndex].classList.add("scared-ghost"),e.isScared&&T[e.currentIndex].classList.contains("pac-man")&&(T[e.currentIndex].classList.remove(e.className,"ghost","scared-ghost"),e.currentIndex=e.startIndex,f+=100,T[e.currentIndex].classList.add(e.className,"ghost")),d()},e.speed)}function d(){T[N].classList.contains("ghost")&&!T[N].classList.contains("scared-ghost")&&(clearInterval(k),I=!1,recognizer.stopListening(),ghosts.forEach(e=>clearInterval(e.timerId)),document.removeEventListener("keyup",n),setTimeout(function(){alert("Game Over")},500))}function l(){274===f&&(clearInterval(k),I=!1,recognizer.stopListening(),ghosts.forEach(e=>clearInterval(e.timerId)),document.removeEventListener("keyup",n),setTimeout(function(){alert("You have WON!")},500))}const m=document.getElementById("score"),h=document.querySelector(".command"),u=(document.querySelector("#play-div button"),document.querySelector("#main-scene")),L=document.querySelector("#game-scene"),g=28;let f=0,p=4,I=!0;const v=document.getElementById("play-div"),w=document.getElementById("loading");let k;e();const b=document.querySelector(".grid"),E=[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,1,1,0,0,0,0,0,0,0,0,0,0,0,0,1,1,0,1,1,1,1,0,0,0,0,0,0,0,1,1,0,0,0,0,0,0,0,1,1,1,1,0,1,1,0,1,3,0,0,0,0,0,0,0,0,0,1,1,0,0,0,0,0,0,0,0,0,3,1,0,1,1,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,1,1,0,1,0,0,4,4,4,4,0,0,0,0,0,0,0,0,0,0,4,4,4,4,0,0,1,0,1,1,0,0,0,0,4,1,1,4,0,0,0,0,0,0,0,0,0,0,4,1,1,4,0,0,0,0,1,1,0,0,0,0,4,1,1,4,0,0,0,0,0,0,0,0,0,0,4,1,1,4,0,0,0,0,1,1,0,0,0,0,4,4,4,4,0,0,0,0,0,0,0,0,0,0,4,4,4,4,0,0,0,0,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,0,0,0,0,0,0,0,0,4,4,4,4,4,4,4,4,4,4,0,0,0,0,0,0,0,0,1,1,0,0,0,0,0,1,0,0,4,1,1,1,2,2,1,1,1,4,0,0,1,0,0,0,0,0,1,1,0,0,0,0,0,1,0,0,4,1,2,2,2,2,2,2,1,4,0,0,1,0,0,0,0,0,1,1,1,1,4,4,4,1,0,0,4,1,2,2,2,2,2,2,1,4,0,0,1,4,4,4,1,1,1,4,4,4,4,4,4,1,0,0,4,1,2,2,2,2,2,2,1,4,0,0,1,4,4,4,4,4,4,1,1,1,4,4,4,1,0,0,4,1,1,1,1,1,1,1,1,4,0,0,1,4,4,4,1,1,1,1,0,0,0,0,0,1,0,0,4,4,4,4,4,4,4,4,4,4,0,0,1,0,0,0,0,0,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,0,0,0,0,4,4,4,4,0,0,0,0,0,0,0,0,0,0,4,4,4,4,0,0,0,0,1,1,0,0,0,0,4,1,1,4,0,0,0,0,0,0,0,0,0,0,4,1,1,4,0,0,0,0,1,1,0,0,0,0,4,1,1,4,0,0,0,0,0,0,0,0,0,0,4,1,1,4,0,0,0,0,1,1,0,1,0,0,4,4,4,4,0,0,0,0,0,0,0,0,0,0,4,4,4,4,0,0,1,0,1,1,0,1,0,0,0,0,0,0,0,0,0,1,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1,1,0,1,3,0,0,0,0,0,0,0,0,1,0,0,1,0,0,0,0,0,0,0,0,3,1,0,1,1,0,1,1,1,1,0,0,0,1,1,1,1,0,0,1,1,1,1,0,0,0,1,1,1,1,0,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],T=[];let M,S,N=490;document.addEventListener("keyup",n);class z{constructor(e,s,t){this.className=e,this.startIndex=s,this.speed=t,this.currentIndex=s,this.isScared=!1,this.timerId=NaN}}ghosts=[new z("blinky",348,250),new z("pinky",376,400),new z("inky",351,300),new z("clyde",379,500)],document.addEventListener("touchstart",e=>{M=e.touches[0].clientX,S=e.touches[0].clientY}),document.addEventListener("touchend",e=>{let s=e.changedTouches[0].clientX,t=e.changedTouches[0].clientY;x=Math.abs(M-s),y=Math.abs(S-t),I&&(x>5||y>5)&&(x>y?a(M>s?4:2):a(S>t?1:3))}),v.addEventListener("click",()=>{s(),u.classList.add("hide"),L.classList.remove("hide"),t(),T[N].classList.add("pac-man"),ghosts.forEach(e=>{T[e.currentIndex].classList.add(e.className),T[e.currentIndex].classList.add("ghost")}),ghosts.forEach(e=>i(e)),k=setInterval(()=>{switch(T[N].classList.remove("pac-man"),p){case 4:N%g==0||T[N-1].classList.contains("wall")||T[N-1].classList.contains("ghost-lair")||(T[N].style.transform="rotate(0deg)",N-=1,T[N].style.transform="rotate(180deg)"),T[N-1]===T[391]&&(T[N].style.transform="rotate(0deg)",N=419,T[N].style.transform="rotate(180deg)");break;case 1:N-g>=0&&!T[N-g].classList.contains("wall")&&!T[N-g].classList.contains("ghost-lair")&&(T[N].style.transform="rotate(0deg)",N-=g,T[N].style.transform="rotate(270deg)");break;case 2:N%g<g-1&&!T[N+1].classList.contains("wall")&&!T[N+1].classList.contains("ghost-lair")&&(T[N].style.transform="rotate(0deg)",N+=1),T[N+1]===T[420]&&(T[N].style.transform="rotate(0deg)",N=392);break;case 3:N+g<g*g&&!T[N+g].classList.contains("wall")&&!T[N+g].classList.contains("ghost-lair")&&(T[N].style.transform="rotate(0deg)",N+=g,T[N].style.transform="rotate(90deg)")}T[N].classList.add("pac-man"),c(),r(),d(),l()},300)})});